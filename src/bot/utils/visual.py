"""–í–∏–∑—É–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã: progress bars, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram.

–î–µ–ª–∞–µ—Ç –æ—Ç—á—ë—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–≥–ª—è–¥–Ω—ã–º–∏ —Å –æ–¥–Ω–æ–≥–æ –≤–∑–≥–ª—è–¥–∞.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    from src.bot.utils.visual import progress_bar, stat_card, format_number
    bar = progress_bar(75, 100, label="–õ–∏–¥—ã")
    # –õ–∏–¥—ã: [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë] 75%
"""

import logging

logger = logging.getLogger(__name__)

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#  PROGRESS BARS
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

_FILLED = "‚ñà"
_EMPTY = "‚ñë"
_BAR_LENGTH = 10


def progress_bar(
    value: int | float,
    total: int | float,
    *,
    label: str = "",
    bar_length: int = _BAR_LENGTH,
    show_percent: bool = True,
    show_numbers: bool = False,
) -> str:
    """–í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è Telegram.

    Args:
        value: –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
        total: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
        label: –ü–æ–¥–ø–∏—Å—å —Å–ª–µ–≤–∞.
        bar_length: –î–ª–∏–Ω–∞ –ø–æ–ª–æ—Å–∫–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö.
        show_percent: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç.
        show_numbers: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–∏—Å–ª–∞ (value/total).

    Returns:
        –°—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞: –õ–∏–¥—ã: [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 40%

    Examples:
        >>> progress_bar(40, 100, label="–õ–∏–¥—ã")
        '–õ–∏–¥—ã: [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 40%'
        >>> progress_bar(7, 10, label="AI", show_numbers=True)
        'AI: [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë] 70% (7/10)'
    """
    if total <= 0:
        pct = 0
    else:
        pct = min(100, max(0, int(value / total * 100)))

    filled = int(bar_length * pct / 100)
    empty = bar_length - filled
    bar = f"[{_FILLED * filled}{_EMPTY * empty}]"

    parts = []
    if label:
        parts.append(f"{label}:")
    parts.append(bar)
    if show_percent:
        parts.append(f"{pct}%")
    if show_numbers:
        parts.append(f"({format_number(value)}/{format_number(total)})")

    return " ".join(parts)


def multi_progress(items: list[tuple[str, int | float, int | float]]) -> str:
    """–ù–∞–±–æ—Ä progress bar –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫.

    Args:
        items: –°–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π (label, value, total).

    Returns:
        –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –±–ª–æ–∫ progress bars —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º.
    """
    if not items:
        return ""

    # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ —Å–∞–º–æ–º—É –¥–ª–∏–Ω–Ω–æ–º—É label
    max_label = max(len(label) for label, _, _ in items)
    lines = []
    for label, value, total in items:
        padded_label = label.ljust(max_label)
        bar = progress_bar(value, total, label=padded_label)
        lines.append(bar)
    return "\n".join(lines)


# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#  STAT CARDS
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê


def stat_card(
    title: str,
    metrics: dict[str, int | float | str],
    *,
    emoji: str = "üìä",
) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ ¬´–∫–∞—Ä—Ç–æ—á–∫—É¬ª –¥–ª—è Telegram (HTML).

    Args:
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏.
        metrics: –°–ª–æ–≤–∞—Ä—å {–Ω–∞–∑–≤–∞–Ω–∏–µ: –∑–Ω–∞—á–µ–Ω–∏–µ}.
        emoji: –≠–º–æ–¥–∑–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

    Returns:
        HTML-–∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è Telegram.
    """
    lines = [f"{emoji} <b>{title}</b>", "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"]
    for key, val in metrics.items():
        if isinstance(val, (int, float)):
            val = format_number(val)
        lines.append(f"‚Ä¢ {key}: <b>{val}</b>")
    return "\n".join(lines)


def dashboard_section(title: str, content: str, *, emoji: str = "üìä") -> str:
    """–°–µ–∫—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º."""
    return f"{emoji} <b>{title}</b>\n{'‚îÄ' * 20}\n{content}"


# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#  –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ß–ò–°–ï–õ
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê


def format_number(n: int | float) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á.

    Examples:
        >>> format_number(1234567)
        '1 234 567'
        >>> format_number(42.5)
        '42.5'
    """
    if isinstance(n, float):
        if n == int(n):
            n = int(n)
        else:
            return f"{n:,.1f}".replace(",", " ")
    return f"{n:,}".replace(",", " ")


def trend_arrow(current: int | float, previous: int | float) -> str:
    """–°—Ç—Ä–µ–ª–∫–∞ —Ç—Ä–µ–Ω–¥–∞: —Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ/—Å—Ç–∞–±–∏–ª—å–Ω–æ.

    Returns:
        üìà +15%, üìâ -10%, –∏–ª–∏ ‚û°Ô∏è 0%
    """
    if previous == 0:
        return "üÜï" if current > 0 else "‚û°Ô∏è 0%"
    pct = int((current - previous) / previous * 100)
    if pct > 0:
        return f"üìà +{pct}%"
    elif pct < 0:
        return f"üìâ {pct}%"
    else:
        return "‚û°Ô∏è 0%"


# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#  BRANDED PDF CAPTION
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê


def guide_caption(
    title: str,
    description: str = "",
    bullets: list[str] | None = None,
) -> str:
    """–ë—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –¥–ª—è PDF-–≥–∞–π–¥–∞ (HTML).

    Args:
        title: –ù–∞–∑–≤–∞–Ω–∏–µ –≥–∞–π–¥–∞.
        description: –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
        bullets: 3 –∫–ª—é—á–µ–≤—ã—Ö –±—É–ª–ª–∏—Ç–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è.

    Returns:
        HTML-–∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∏.
    """
    lines = [f"üìö <b>{title}</b>"]

    if description:
        lines.append(f"\n<i>{description}</i>")

    if bullets:
        lines.append("\nüìã <b>–í —ç—Ç–æ–º –≥–∞–π–¥–µ:</b>")
        for b in bullets[:5]:
            lines.append(f"  ‚Ä¢ {b}")

    lines.append(
        "\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
        "üí° <i>–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ó–∞–¥–∞–π—Ç–µ –∏—Ö AI-—é—Ä–∏—Å—Ç—É ‚Üí /consult</i>\n"
        "‚öñÔ∏è <b>SOLIS Partners</b> ‚Äî –≤–∞—à —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä"
    )

    return "\n".join(lines)
